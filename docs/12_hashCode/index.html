<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>hashCode - Cal Poly CSC 203 Lecture notes</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Cal Poly CSC 203 Lecture notes</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="hashcode"><a class="header" href="#hashcode"><code>hashCode</code></a></h1>
<blockquote>
<p>This brief lesson is about the <code>hashCode</code> function in the <code>Object</code> class.</p>
<ul>
<li>Like <code>toString</code> and <code>equals</code>, all classes inherit (or can override) the <code>Object</code>'s <code>hashCode</code> function.</li>
<li>Like <code>toString</code> and <code>equals</code>, you should write a <code>hashCode</code> for new classes that you create.</li>
</ul>
</blockquote>
<p>The purpose of the <code>hashCode</code> function is to generate an as-far-as-possible unique integer for distinct objects.
The produced integer should be consistent for the object.
That is, the produced integer should not change unless the object itself is changed in some way.</p>
<h2 id="whats-hashcode-used-for"><a class="header" href="#whats-hashcode-used-for">What's <code>hashCode</code> used for?</a></h2>
<p>Think about the <code>HashMap</code> data structure, discussed <a href="../03_lists_maps_existing_classes/">in a previous lesson</a>.
The <code>HashMap</code> supports these fundamental operations:</p>
<ul>
<li><code>put</code> entries (key-value pairs) into the map</li>
<li><code>get</code> values from the map quickly, using a key</li>
</ul>
<p>The operations above can, for the most part, be done in constant time.
This is possible because of the "hash" part of the data structure.</p>
<p>Suppose you are trying to use a given key <code>k</code> to put some value <code>v</code> into the map.
The <code>HashMap</code> uses the key's <code>hashCode</code> value to "find a place" for <code>v</code>.
That is, you can imagine that it calls <code>k.hashCode()</code> to produce some unique integer, and uses that integer to choose a position in which to store <code>v</code>.</p>
<p>The same thing is done when we try to retrieve <code>v</code> from the map, using the key <code>k</code>.
That is, the map will call <code>k.hashCode()</code> again, come up with the <em>same integer</em> as before, and find the value <code>v</code>.
If done well, this can happen without searching the entire set of entries — so no matter how many records are in the map, we do the same amount of work to look up a value using its key.</p>
<h3 id="a-hashcode-is-an-integer"><a class="header" href="#a-hashcode-is-an-integer">A <code>hashCode</code> is an integer</a></h3>
<p>The <code>hashCode</code> function has the following signature in the <code>Object</code> class:</p>
<p><code>public int hashCode()</code></p>
<p>So any override in a class you create must also have the same signature, otherwise it will not actually override the <code>hashCode</code> function, and won't be used by data structures like the <code>HashMap</code> or <code>HashSet</code>.</p>
<p>Ok, fine, it's a method that returns an <code>int</code>. That's easy enough! But you can't return any old integer. It's important to, as far as possible, return a <em>unique</em> integer for any given object, and to have that integer be consistent across multiple calls to <code>hashCode</code> unless the object changes.</p>
<p>When distinct objects have distinct <code>hashCode</code>s, this ensures that the objects are appropriately "spread out" in a map or set.
On the other hand, if many distinct keys produce the same <code>hashCode</code>, then those keys would "collide" in the map or set.
Maps and sets are able to handle these collisions (e.g., a simple way is to "stack up" all the keys that have the same <code>hashCode</code>).
But the more collisions you have, the more your map's performance degrades.
That is, if many collisions occur, then the bigger your map gets, the more time it takes to add to retrieve items from it.</p>
<blockquote>
<p>Having distinct hash codes for distinct objects ensures that the performance of the <code>get</code>, <code>put</code>, and <code>contains</code> operations for maps and sets remain as close to constant time as possible.</p>
</blockquote>
<h3 id="equals-and-hashcode-go-hand-in-hand"><a class="header" href="#equals-and-hashcode-go-hand-in-hand"><code>equals</code> and <code>hashCode</code> go hand-in-hand</a></h3>
<p>The <code>equals</code> and <code>hashCode</code> methods <em>must</em> go hand-in-hand.</p>
<p>When you try to <code>get</code> an item from a map using a key, the following steps take place (a simplified overview):</p>
<ol>
<li>Use the key's <code>hashCode</code> to "find" the data in the map.</li>
<li>When you reach the computed position, check if the provided key <code>equals</code> the key in the map entry.</li>
<li>If the two keys are <code>equal</code>, return the value from the map entry.</li>
<li>If the two keys are <em>not</em> <code>equal</code>, follow the map's collision resolution policy to check the next possible location, or return <code>null</code>.</li>
</ol>
<p><strong>This suggests that <code>hashCode</code> and <code>equals</code> should always take the same information into account, and should always "agree" with each other.</strong>
Not doing this will result in strange and incorrect behaviour in your <code>HashMap</code>s and <code>HashSet</code>s.</p>
<p>These leads us to the following "contract" for the <code>hashCode</code> and <code>equals</code> methods in any class<sup class="footnote-reference" id="fr-javadoc-1"><a href="#footnote-javadoc">1</a></sup>:</p>
<ul>
<li>When <code>hashCode</code> is called more than once on the same object, it should consistently return the same integer, provided that no fields that are used in the <code>equals</code> method have been modified.</li>
<li>If two objects are "equal" according to the <code>equals</code> method, then calling <code>hashCode</code> on them <em>must</em> produce the same integer.</li>
<li>If two objects are <em>not</em> "equal" according to the <code>equals</code> method, it's difficult to guarantee that they return distinct integer results. But doing this as far as possible will improve <code>HashMap</code> and <code>HashSet</code> performance.</li>
</ul>
<h2 id="writing-a-hashcode-function"><a class="header" href="#writing-a-hashcode-function">Writing a <code>hashCode</code> function</a></h2>
<p>So, how to write a good <code>hashCode</code>?
That's...out of scope for this class, and is an important research problem in its own right.
The <a href="https://opendsa-server.cs.vt.edu/ODSA/Books/Everything/html/HashIntro.html">OpenDSA Chapter on Hashing</a> is a really good overview.</p>
<p>In this example, we'll look at two examples of <code>hashCode</code> functions.</p>
<p>Suppose we have a simple <code>Person</code> class (the same one we used in <a href="../11_inheritance_equality/">the previous lesson</a>). Each <code>Person</code> has two properties:</p>
<ul>
<li><code>int age</code></li>
<li><code>String name</code></li>
</ul>
<p>And two <code>Person</code>s are considered <code>equal</code> to each other if they have equal names and ages.
This means that:</p>
<ol>
<li>Two <code>Person</code>s with equal names and ages should produce the same hash code.</li>
<li>If two <code>Person</code>s differ in name or age or both, they should produce different hash codes, as far as possible.</li>
</ol>
<p>We'll look at two ways of writing the <code>hashCode</code> function.</p>
<h3 id="rolling-our-own"><a class="header" href="#rolling-our-own">Rolling our own</a></h3>
<p>One option is to compute an integer ourselves.
We should make use of all instance variables that factor into the <code>equals</code> decision in order to meet the "contract" we talked about earlier, and we need to make it so that differences in the values of those instance variables will result in differences in our final integer.</p>
<p>Here's an example.</p>
<ul>
<li>In the code below, we start with the number <code>1</code>.</li>
<li>Then we multiply by <code>37</code> — multiplying by a prime number like <code>37</code> makes it more likely for us to produce a number that other objects <em>won't</em> produce. You can use any prime number you want.</li>
<li>Then we add the <code>name</code>'s <code>hashCode</code> value. The <code>String</code> class already has a <code>hashCode</code> function, so we don't need to re-invent that. Note that we are assuming here that the <code>name</code> is not <code>null</code>! We can do this because we <a href="../11_inheritance_equality#equals">included code to guarantee this in the previous lesson</a> If it's possible for <code>name</code> to be <code>null</code>, then you need to check that first.</li>
<li>We multiply this result again by <code>37</code>, then add the <code>age</code>.</li>
</ul>
<pre><code class="language-java">@Override
public int hashCode() {
  int result = 1;

  result = result * 37 + this.name.hashCode();
  result = result * 37 + this.age;

  return result;
}
</code></pre>
<h3 id="using-existing-methods"><a class="header" href="#using-existing-methods">Using existing methods</a></h3>
<p>A lot has been said or written about generating good hash values for different primitive data types (which in turn can be used as building blocks for generating hash values for reference types).
Many of these ideas have been implemented already.
In many cases it's better to use existing implementations instead of re-inventing the wheel.</p>
<p>The <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/Objects.html"><code>Objects</code></a><sup class="footnote-reference" id="fr-s-1"><a href="#footnote-s">2</a></sup> class in Java contains number of useful static methods, among them utilities for generating a hash code based on a given set of fields.</p>
<p>The <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/Objects.html#hash(java.lang.Object...)"><code>hash</code></a> static function takes in a list of parameters, and generates a hash code based on those values.
So we could rewrite the <code>hashCode</code> for our <code>Person</code> class as:</p>
<pre><code class="language-java">@Override
public int hashCode() {
  return Objects.hash(this.name, this.age);
}
</code></pre>
<p>The <code>Objects</code> class also provides the <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/Objects.html#equals(java.lang.Object,java.lang.Object)"><code>Objects.equals</code></a> function. You can use <code>Objects.equals(a, b)</code> instead of <code>a.equals(b)</code>.
This is useful in cases you are not sure if <code>a</code> is null or not — <code>a.equals(b)</code> would crash with a <code>NullPointerException</code> if <code>a</code> was null, whereas <code>Objects.equals</code> checks that for you, or you could check it yourself.</p>
<hr>
<ol class="footnote-definition"><li id="footnote-javadoc">
<p>Paraphrased from the <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#hashCode()">Object documentation</a>. <a href="#fr-javadoc-1">↩</a></p>
</li>
<li id="footnote-s">
<p>Notice the "s" in <code>Objects</code>. <a href="#fr-s-1">↩</a></p>
</li>
</ol>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../11_inheritance_equality/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../13_comparable_comparator/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../11_inheritance_equality/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../13_comparable_comparator/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../mermaid.min.js"></script>
        <script src="../mermaid-init.js"></script>



    </div>
    </body>
</html>
